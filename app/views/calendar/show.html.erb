<div class="app-container">
    <%= render 'shared/navbar' %>

    <main class="main-content">
        <div id="calendarPage" class="page">
            <div class="page-header align">
                <div>
                    <h1 class="page-title">Calendar</h1>
                    <p class="page-subtitle">Your Google Calendar events</p>
                </div>
                <div>
                    <%= link_to "Add Event", add_calendar_event_path(), class: "btn btn-primary" %>
                </div>
            </div>

            <div class="content-area">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-month"><%= @current_date.strftime("%B %Y") %></div>
                        <div class="calendar-nav">
                            <%= link_to "← Previous", calendar_path(date: @current_date.prev_month.to_s) %>
                            <%= link_to "Next →", calendar_path(date: @current_date.next_month.to_s) %>
                            <%= link_to "Refresh", calendar_path %>
                        </div>
                    </div>
                    
                    <div class="calendar-content">
                        <% if @events.any? %>
                            <% @events.each do |event| %>
                                <div class="event-card align">
                                    <div>
                                        <h3><%= event[:summary].presence || 'Untitled Event' %></h3>
                                        <p>
                                            <%= event[:start].strftime("%d %B %Y") %>
                                            <% unless event[:is_all_day] %>
                                                <%= event[:start].strftime("%l:%M %p") %> - <%= event[:end].strftime("%l:%M %p") %>
                                            <% else %>
                                                (All day)
                                            <% end %>
                                        </p>
                                    </div>
                                    
                                    <div class="align" style="gap:20px">
                                        <%= button_to "Edit Event", edit_calendar_event_path(event[:id]), method: :get, class: "btn btn-secondary" %>
                                    
                                        <%= button_to "Delete", 
                                            api_calendar_event_path(event[:id]), 
                                            method: :delete,
                                            form: { 
                                                data: { 
                                                    turbo_confirm: 'Are you sure you want to delete this event?' 
                                                } 
                                            },
                                            class: "btn btn-danger" %>
                                    </div>
                                    
                                </div>
                            <% end %>
                        <% else %>
                            <p>No events found for this month.</p>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>